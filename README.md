# Telegram-бот "Камни онлайн"


## API

## Взаимодействие с telegram

## Database
Слой database используется для непосредственного взаимодействия с базой данных бота.
Две сущности:
- User, обозначающий всех, кто пользуется ботом в роли клиента
- Lobby - сущность, управляющая лобби и логикой игры

Представляют собой обёртки над БД, с кешированием, и представлены двумя singletone-классами

Для получения админских прав можно использовать запрос к БД:

```PostgreSQL
UPDATE public."user" 
SET status='admin'
where id=[ВАШ ID в ТЕЛЕГРАМ];
```

Либо указать в переменную окружения при запуске бота для получения статуса SUPREME_ADMIN
```bash
SUPREME_ADMIN_ID=123412314
```

В качестве СУБД используется PostgreSQL-17.0

#### Изменение данных в БД во время работы бота может привести к конфликтам из-за кеширования, желательно все изменения производить через сущности.

Каждое лобби - отдельная схема в БД, изолированная от остальных

При остановке БД, состояние игры сохраняется (если что-то не сохраняется, считать багом)


## Запуск и развёртка

Приложение запускается при помощи Docker, для Dockerfile можно найти в репозитории, также параллельно поднимается контейнер с БД

```dockerfile
docker compose up
```

Автоматически поднимает два контейнера - с приложением и с БД, устанавливая все зависимости и инициализируя БД.

При запуске может возникнуть конфликт портов, если на используемых (5000 для приложения и 5432 для БД) уже что-то запущено.

Проверить это можно с помощью команды

```bash
sudo lsof -i -P -n | grep LISTEN | grep 5432
```
